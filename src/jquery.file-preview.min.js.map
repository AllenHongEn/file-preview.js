{"version":3,"sources":["jquery.file-preview.js"],"names":["$","filePreview","input_file","_version","_preview_url","file","URL","createObjectURL","format_float","num","pos","size","Math","pow","round","_reader_base64","index","box","param","reader","FileReader","onprogress","data","lengthComputable","percent","parseInt","loaded","total","progress","call","onload","e","base64","target","result","success","readAsDataURL","_filename_extension","filename","extIndex","lastIndexOf","name","substr","ext","length","_each_files","files","each","preview","nameMaster","nameExtension","type","byte","kb","mb","isReader","_selector","undefined","parent","selector","find","version","create","fn","on","this","val","jQuery"],"mappings":";CAAC,SAAUA,GAEPA,EAAEC,cAEF,IAIIC,GAJAC,EAAW,QAMXC,EAAe,SAAUC,GACzB,MAAOC,KAAIC,gBAAgBF,IAI3BG,EAAe,SAASC,EAAKC,GAC7B,GAAIC,GAAOC,KAAKC,IAAI,GAAIH,EACxB,OAAOE,MAAKE,MAAML,EAAME,GAAQA,GAGhCI,EAAiB,SAAUV,EAAMW,EAAOC,EAAKC,GAE7C,GAAIC,GAAS,GAAIC,WAGjBD,GAAOE,WAAa,SAAUC,GAC1B,GAAIA,EAAKC,iBAAkB,CACvB,GAAIC,GAAUC,SAAYH,EAAKI,OAASJ,EAAKK,MAAS,IAAM,GAC5DT,GAAMU,SAASC,KAAK3B,EAAYc,EAAOQ,KAK/CL,EAAOW,OAAS,SAAUC,GAEtBd,EAAIe,OAASD,EAAEE,OAAOC,OACtBhB,EAAMiB,QAAQN,KAAK3B,EAAYc,EAAOC,IAG1CE,EAAOiB,cAAc/B,IAIrBgC,EAAsB,SAAUC,GAEhC,GAAIC,GAAWD,EAASE,YAAY,IAEpC,IAAgB,IAAZD,EACD,GAAIE,GAAOH,EAASI,OAAO,EAAGH,GAC1BI,EAAML,EAASI,OAAOH,EAAS,EAAGD,EAASM,OAGlD,QAAQH,EAAME,IAIdE,EAAc,SAAUC,EAAO5B,GAE/BlB,EAAE+C,KAAKD,EAAO,SAAU9B,EAAOX,GAG3B,GAAIY,IACA+B,QAAS5C,EAAaC,GACtBA,KAAMA,EACN4C,WAAYZ,EAAoBhC,EAAKoC,MAAM,GAC3CS,cAAeb,EAAoBhC,EAAKoC,MAAM,GAC9CU,KAAM9C,EAAK8C,KACXxC,MACIyC,OAAM/C,EAAKM,KACX0C,GAAI7C,EAAaH,EAAKM,KAAO,KAAM,GACnC2C,GAAI9C,EAAaH,EAAKM,KAAO,KAAO,KAAM,IAK9CO,GAAMqC,SACNxC,EAAeV,EAAMW,EAAOC,EAAKC,GAGjCA,EAAMiB,QAAQN,KAAK3B,EAAYc,EAAOC,MAM9CuC,EAAY,SAAUtC,GAEtB,MAAqBuC,UAAjBvC,EAAMwC,QAA2CD,SAAnBvC,EAAMyC,SAC7B3D,EAAEC,YAGND,EAAEkB,EAAMwC,QAAQE,KAAK1C,EAAMyC,UAGtC3D,GAAEC,YAAY4D,QAAU,WACpB,MAAO1D,IAWXH,EAAEC,YAAY6D,OAAS,SAAUH,EAAUzC,GAEvChB,EAAasD,EAAUtC,GAEnByC,EAASb,OAASa,EAASb,MAAM,IACjCD,EAAYc,EAASb,MAAO5B,IAapClB,EAAE+D,GAAG9D,YAAc,SAAUiB,GAEzBlB,EAAEkB,EAAMwC,QAAQM,GAAG,SAAU9C,EAAMyC,SAAU,WAEzC3D,EAAEC,YAAY6D,OAAOG,KAAM/C,GAG3BhB,EAAWgE,IAAI,UAOxBC","file":"jquery.file-preview.min.js","sourcesContent":["(function ($) {\r\n\r\n    $.filePreview = {};\r\n\r\n    var _version = \"1.0.0\";\r\n\r\n\r\n    // 記錄綁定對象\r\n    var input_file;\r\n\r\n    var _preview_url = function (file){\r\n        return URL.createObjectURL(file);\r\n    }\r\n\r\n    // size 大小格式化\r\n    var format_float = function(num, pos){\r\n        var size = Math.pow(10, pos);\r\n        return Math.round(num * size) / size;\r\n    }\r\n\r\n    var _reader_base64 = function (file, index, box, param){\r\n\r\n        var reader = new FileReader();\r\n\r\n        // 讀取進度\r\n        reader.onprogress = function (data){\r\n            if (data.lengthComputable) {                                            \r\n                var percent = parseInt( ((data.loaded / data.total) * 100), 10 );\r\n                param.progress.call(input_file, index, percent);\r\n            }\r\n        }\r\n\r\n        // 若有使用 Base64\r\n        reader.onload = function (e) {\r\n            // base64 網址\r\n            box.base64 = e.target.result;\r\n            param.success.call(input_file, index, box);\r\n        }\r\n\r\n        reader.readAsDataURL(file);\r\n    }\r\n\r\n    // 主檔名 / 副檔名\r\n    var _filename_extension = function (filename){\r\n        \r\n        var extIndex = filename.lastIndexOf('.');\r\n         \r\n        if (extIndex != -1) {\r\n           var name = filename.substr(0, extIndex); //檔名不含副檔名\r\n           var ext = filename.substr(extIndex+1, filename.length); //副檔名\r\n        }\r\n\r\n        return [name, ext];\r\n    }\r\n\r\n\r\n    var _each_files = function (files, param){\r\n\r\n        $.each(files, function (index, file){\r\n\r\n            // 預覽圖網址\r\n            var box = {\r\n                preview: _preview_url(file),\r\n                file: file,\r\n                nameMaster: _filename_extension(file.name)[0],\r\n                nameExtension: _filename_extension(file.name)[1],\r\n                type: file.type,\r\n                size: {\r\n                    byte: file.size, \r\n                    kb: format_float(file.size / 1024, 2),\r\n                    mb: format_float(file.size / 1024 / 1024, 2),\r\n                }\r\n            };\r\n\r\n            // 使用 isReader\r\n            if (param.isReader) {\r\n                _reader_base64(file, index, box, param);\r\n            }\r\n            else {\r\n                param.success.call(input_file, index, box);\r\n            }\r\n        });\r\n    }\r\n\r\n    // 綁定的對象\r\n    var _selector = function (param){\r\n\r\n        if (param.parent === undefined || param.selector === undefined){\r\n            return $.filePreview;\r\n        }\r\n\r\n        return $(param.parent).find(param.selector);\r\n    }\r\n\r\n    $.filePreview.version = function (){\r\n        return _version;\r\n    }\r\n\r\n    /**\r\n     * 建立\r\n     * @param   selector 通常為 input:file 的 this\r\n     * @param   param.success   function    callback(object) 單筆成功所觸發\r\n     * @param   param.isReader  bool        *false 若開啟, 當讀取大圖時的轉換時間，容易造成瀏覽器記憶體不足\r\n     *                                      開啟才能觸發 callback progress() 與取得 Base64 編碼\r\n     * @param   param.progress  function    callback(percent) 取得進度\r\n     */\r\n    $.filePreview.create = function (selector, param){\r\n\r\n        input_file = _selector(param);\r\n\r\n        if (selector.files && selector.files[0]) {\r\n            _each_files(selector.files, param);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 使用綁定的簡單操作\r\n     * @param   param.parent    string\r\n     * @param   param.selector  string\r\n     * @param   param.success   function    callback(object) 單筆成功所觸發\r\n     * @param   param.isReader  bool        *false 若開啟, 當讀取大圖時的轉換時間，容易造成瀏覽器記憶體不足\r\n     *                                      開啟才能觸發 callback progress() 與取得 Base64 編碼\r\n     * @param   param.progress  function    callback(percent) 取得進度\r\n     */\r\n    $.fn.filePreview = function (param){\r\n        \r\n        $(param.parent).on(\"change\", param.selector, function (){\r\n\r\n            $.filePreview.create(this, param)\r\n\r\n            // input:file 重設\r\n            input_file.val(null);\r\n        })\r\n\r\n    }\r\n\r\n\r\n\r\n}( jQuery ));"]}